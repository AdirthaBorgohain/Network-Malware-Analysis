from sklearn.preprocessing import MinMaxScaler
import joblib
import pandas as pd
import numpy as np

DATA_DIR = '../aws/'
JOBLIB_DIR = '../joblibs'

def load_data(filename):
    df = pd.read_csv(DATA_DIR + filename, low_memory=False)

    df.drop_duplicates(inplace=True)

    df = df[df['Flow Byts/s'] != 'Infinity']
    df['Flow Byts/s'] = pd.to_numeric(df['Flow Byts/s'])

    df = df[df['Flow Pkts/s'] != 'Infinity']
    df['Flow Pkts/s'] = pd.to_numeric(df['Flow Pkts/s'])

    df.drop(['Timestamp'], inplace=True, axis=1)
    X = df.iloc[:, :78]

    columns = X.columns

    scalar = joblib.load(JOBLIB_DIR + 'scaler.joblib')
    X = scalar.transform(X)

    X = pd.DataFrame(X, columns=columns)

    sel_cols = joblib.load(JOBLIB_DIR + 'selected_columns.joblib')

    X = X[sel_cols]

    return X


def predict(X):
    model = joblib.load(JOBLIB_DIR + 'model.joblib')

    y_pred = model.predict(X)

    return list(y_pred)

